<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clanker v3.1 æµåŠ¨æ€§åˆ†æå™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #2196F3, #42A5F5);
            color: white;
            border-radius: 10px;
        }
        
        .info-section, .chart-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .analyze-btn {
            padding: 12px 30px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .analyze-btn:hover {
            background: #1976D2;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .summary-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        
        .summary-card h3 {
            margin: 0 0 15px 0;
            color: #2196F3;
        }
        
        .summary-card p {
            margin: 8px 0;
            color: #555;
        }

        .results-section {
            display: none;
        }
        
        .v3-highlight {
            background: #e3f2fd;
            border: 2px solid #2196F3;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“Š Clanker v3.1 æµåŠ¨æ€§åˆ†æå™¨</h1>
        <p>åˆ†æv3.1ç‰ˆæœ¬çš„å•è¾¹æµåŠ¨æ€§é…ç½®</p>
    </div>

    <div class="info-section">
        <h2>ğŸ”§ v3.1 æµåŠ¨æ€§ç‰¹ç‚¹</h2>
        <div class="v3-highlight">
            <h3>ğŸ¯ æ ¸å¿ƒç‰¹å¾:</h3>
            <ul>
                <li>âœ… <strong>å•è¾¹æµåŠ¨æ€§</strong>: åªæä¾›ä»£å¸ï¼Œä¸æä¾›é…å¯¹èµ„äº§(ETH/WETH)</li>
                <li>âœ… <strong>å›ºå®šè´¹ç‡</strong>: 1.00% äº¤æ˜“æ‰‹ç»­è´¹ï¼ˆUniswap V3æœ€é«˜æ ‡å‡†è´¹ç‡ï¼‰</li>
                <li>âœ… <strong>ç®€å•ç­–ç•¥</strong>: å•ä¸€ä»·æ ¼èŒƒå›´ï¼Œä»åˆå§‹Tickåˆ°æœ€å¤§Tick</li>
                <li>âœ… <strong>å›ºå®šä¾›åº”</strong>: 1000äº¿ä»£å¸æ€»ä¾›åº”ï¼Œ70%æä¾›æµåŠ¨æ€§</li>
                <li>âœ… <strong>é‡‘åº“æœºåˆ¶</strong>: å¯é…ç½®çš„ä»£å¸é”å®šæ¯”ä¾‹</li>
            </ul>
        </div>
        
        <h3>ğŸ“‹ ç¤ºä¾‹æ•°æ® (noiceä»£å¸)</h3>
        <div style="background: #f0f8f0; padding: 15px; border-radius: 8px; font-family: monospace;">
            <p><strong>äº¤æ˜“å“ˆå¸Œ:</strong> 0x009332549dbca862ea6d309bafcfa689f021a29001fccc6e9a93692944f3a07e</p>
            <p><strong>ä»£å¸åç§°:</strong> noice</p>
            <p><strong>ä»£å¸ç¬¦å·:</strong> NOICE</p>
            <p><strong>åˆå§‹ä»·æ ¼Tick:</strong> -230400</p>
            <p><strong>é‡‘åº“æ¯”ä¾‹:</strong> 30% (300äº¿ä»£å¸é”å®š)</p>
            <p><strong>æµåŠ¨æ€§ä¾›åº”:</strong> 70% (700äº¿ä»£å¸)</p>
            <p><strong>åˆå§‹è´­ä¹°:</strong> 1.0 ETH</p>
        </div>
        
        <button class="analyze-btn" onclick="analyzeV3Liquidity()" style="margin-top: 20px;">åˆ†æv3.1æµåŠ¨æ€§é…ç½®</button>
    </div>

    <div id="results" class="results-section">
        <!-- ç»“æœå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
    </div>


    <script>
        let chart = null;
        
        // v3.1 ç¤ºä¾‹æ•°æ®
        const v3SampleData = {
            tokenName: "noice",
            tokenSymbol: "NOICE", 
            totalSupply: 100000000000, // 1000äº¿
            initialTick: -230400,
            vaultPercentage: 30,
            liquidityPercentage: 70,
            initialBuyETH: 1.0,
            feeRate: 10000, // 1.00%
            // v3.1æ˜¯å•è¾¹æµåŠ¨æ€§ï¼Œä»initialTickåˆ°MAX_TICK
            liquidityRange: {
                tickLower: -230400,
                tickUpper: 887200, // MAX_TICK for 1% fee tier
                tokens: 70000000000 // 700äº¿ä»£å¸
            }
        };
        
        function tickToPrice(tick) {
            return Math.pow(1.0001, tick);
        }
        
        function analyzeV3Liquidity() {
            const analysis = processV3Data(v3SampleData);
            displayV3Results(analysis);
            document.getElementById('results').style.display = 'block';
        }
        
        function processV3Data(data) {
            const initialPrice = tickToPrice(data.initialTick);
            const maxPrice = tickToPrice(data.liquidityRange.tickUpper);
            const minPrice = initialPrice;
            
            return {
                tokenName: data.tokenName,
                tokenSymbol: data.tokenSymbol,
                totalSupply: data.totalSupply,
                vaultTokens: data.totalSupply * data.vaultPercentage / 100,
                liquidityTokens: data.totalSupply * data.liquidityPercentage / 100,
                initialTick: data.initialTick,
                initialPrice: initialPrice,
                minPrice: minPrice,
                maxPrice: maxPrice,
                priceRange: (maxPrice / minPrice).toExponential(2),
                feeRate: data.feeRate / 10000,
                initialBuyETH: data.initialBuyETH,
                liquidityRange: {
                    ...data.liquidityRange,
                    priceLower: minPrice,
                    priceUpper: maxPrice
                }
            };
        }
        
        function displayV3Results(analysis) {
            const resultsDiv = document.getElementById('results');
            
            const html = `
                <div class="info-section">
                    <h2 style="color: #2196F3; margin-bottom: 20px;">ğŸ“Š ${analysis.tokenSymbol} æµåŠ¨æ€§åˆ†æç»“æœ</h2>

                    <div class="summary-cards">
                        <div class="summary-card">
                            <h3>ğŸ“‹ åŸºæœ¬ä¿¡æ¯</h3>
                            <p><strong>ä»£å¸åç§°:</strong> ${analysis.tokenName}</p>
                            <p><strong>ä»£å¸ç¬¦å·:</strong> ${analysis.tokenSymbol}</p>
                            <p><strong>æ€»ä¾›åº”é‡:</strong> ${(analysis.totalSupply / 1000000000).toFixed(0)}åäº¿ ä»£å¸</p>
                            <p><strong>æµåŠ¨æ€§ä¾›åº”:</strong> ${(analysis.liquidityTokens / 1000000000).toFixed(0)}åäº¿ ä»£å¸</p>
                            <p><strong>é‡‘åº“é”å®š:</strong> ${(analysis.vaultTokens / 1000000000).toFixed(0)}åäº¿ ä»£å¸</p>
                        </div>

                        <div class="summary-card">
                            <h3>ğŸ’° ä»·æ ¼ä¿¡æ¯</h3>
                            <p><strong>åˆå§‹ä»·æ ¼:</strong> ${analysis.initialPrice.toExponential(3)} WETH</p>
                            <p><strong>ä»·æ ¼ä¸Šé™:</strong> æ— é™åˆ¶ (MAX_TICK)</p>
                            <p><strong>ç†è®ºèŒƒå›´:</strong> ${analysis.priceRange}x</p>
                            <p><strong>åˆå§‹Tick:</strong> ${analysis.initialTick}</p>
                            <p><strong>æ‰‹ç»­è´¹ç‡:</strong> ${analysis.feeRate}%</p>
                        </div>

                        <div class="summary-card">
                            <h3>ğŸ¯ v3.1 ç­–ç•¥ç‰¹ç‚¹</h3>
                            <p><strong>æµåŠ¨æ€§æ¨¡å¼:</strong> å•è¾¹æµåŠ¨æ€§</p>
                            <p><strong>ä»·æ ¼ç­–ç•¥:</strong> å•ä¸€èŒƒå›´ (ç®€å•)</p>
                            <p><strong>åˆå§‹è´­ä¹°:</strong> ${analysis.initialBuyETH} ETH</p>
                            <p><strong>èµ„æœ¬æ•ˆç‡:</strong> ä½ (èŒƒå›´è¿‡å®½)</p>
                            <p><strong>é€‚ç”¨åœºæ™¯:</strong> æ–°ä»£å¸å¯åŠ¨</p>
                        </div>
                    </div>
                </div>

                <div class="chart-section">
                    <h3>ğŸ“ˆ v3.1 å•è¾¹æµåŠ¨æ€§åˆ†å¸ƒå›¾</h3>
                    <canvas id="v3LiquidityChart" style="max-height: 400px; width: 100%;"></canvas>
                </div>

                <div class="info-section">
                    <h3>ğŸ“Š è¯¦ç»†åˆ†æ</h3>
                    <div class="v3-highlight">
                        <h4>ğŸŠ æµåŠ¨æ€§é…ç½®è¯¦æƒ…:</h4>
                        <p><strong>ä»·æ ¼èŒƒå›´:</strong> [${analysis.liquidityRange.priceLower.toExponential(6)}, âˆ] WETH</p>
                        <p><strong>TickèŒƒå›´:</strong> [${analysis.liquidityRange.tickLower.toLocaleString()}, ${analysis.liquidityRange.tickUpper.toLocaleString()}]</p>
                        <p><strong>æµåŠ¨æ€§å¯†åº¦:</strong> ${Math.round(analysis.liquidityRange.tokens / (analysis.liquidityRange.tickUpper - analysis.liquidityRange.tickLower)).toLocaleString()} ä»£å¸/tick</p>
                        
                    </div>
                </div>
            `;

            resultsDiv.innerHTML = html;
            generateV3Chart(analysis);
        }
        
        function generateV3Chart(analysis) {
            const ctx = document.getElementById('v3LiquidityChart').getContext('2d');

            // é”€æ¯ç°æœ‰å›¾è¡¨
            if (chart) {
                chart.destroy();
            }

            // åˆ›å»ºv3.1çš„å•è¾¹æµåŠ¨æ€§å¯è§†åŒ–
            // v3.1æ˜¯ä»åˆå§‹ä»·æ ¼åˆ°æ— ç©·å¤§çš„çŸ©å½¢åŒºåŸŸ
            const datasets = [{
                label: 'v3.1 å•è¾¹æµåŠ¨æ€§',
                data: [
                    {x: analysis.minPrice, y: 0},
                    {x: analysis.minPrice, y: analysis.liquidityTokens / 100000000}, // äº¿ä¸ºå•ä½
                    {x: analysis.maxPrice * 0.1, y: analysis.liquidityTokens / 100000000}, // æ˜¾ç¤ºéƒ¨åˆ†èŒƒå›´
                    {x: analysis.maxPrice * 0.1, y: 0}
                ],
                backgroundColor: 'rgba(33, 150, 243, 0.3)',
                borderColor: '#2196F3',
                borderWidth: 2,
                fill: true,
                tension: 0,
                pointRadius: 0,
                pointHoverRadius: 8
            }];

            // æ·»åŠ åˆå§‹ä»·æ ¼æ ‡è®°
            datasets.push({
                label: 'åˆå§‹ä»·æ ¼',
                data: [{x: analysis.initialPrice, y: 0}],
                backgroundColor: '#ff5722',
                borderColor: '#ff5722',
                pointRadius: 15,
                pointHoverRadius: 20,
                showLine: false,
                type: 'scatter'
            });

            chart = new Chart(ctx, {
                type: 'line',
                data: { datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.5,
                    scales: {
                        x: {
                            type: 'logarithmic',
                            title: {
                                display: true,
                                text: `${analysis.tokenSymbol}ä»·æ ¼ (1 ${analysis.tokenSymbol} = ? WETH) - å¯¹æ•°åˆ»åº¦`,
                                font: { size: 14, weight: 'bold' }
                            },
                            min: analysis.minPrice * 0.5,
                            max: analysis.maxPrice * 0.1, // æ˜¾ç¤ºæœ‰é™èŒƒå›´
                            ticks: {
                                callback: function(value) {
                                    return value.toExponential(2);
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'æµåŠ¨æ€§ (äº¿ä»£å¸)',
                                font: { size: 14, weight: 'bold' }
                            },
                            min: 0,
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(0) + 'äº¿';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'nearest',
                            intersect: false,
                            callbacks: {
                                title: function(context) {
                                    if (context[0].datasetIndex === 1) {
                                        return 'ğŸ“ åˆå§‹ä»·æ ¼æ ‡è®°';
                                    }
                                    return context[0].dataset.label;
                                },
                                label: function(context) {
                                    if (context.datasetIndex === 1) {
                                        return `åˆå§‹ä»·æ ¼: ${analysis.initialPrice.toExponential(6)} WETH`;
                                    }

                                    return [
                                        `ä»·æ ¼èŒƒå›´: [${analysis.minPrice.toExponential(6)}, âˆ] WETH`,
                                        `æµåŠ¨æ€§: ${(analysis.liquidityTokens / 1000000000).toFixed(0)}åäº¿ä»£å¸ (70%)`,
                                        `TickèŒƒå›´: [${analysis.liquidityRange.tickLower.toLocaleString()}, ${analysis.liquidityRange.tickUpper.toLocaleString()}]`,
                                        `ç‰¹ç‚¹: v3.1å•è¾¹æµåŠ¨æ€§ï¼Œèµ„æœ¬æ•ˆç‡è¾ƒä½ä½†è¦†ç›–å…¨èŒƒå›´`
                                    ];
                                }
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>